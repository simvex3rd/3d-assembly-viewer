<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>3D Assembly Report</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body { font-family: 'Segoe UI', sans-serif; background: #0d1117; color: #c9d1d9; line-height: 1.6; }

  header {
    background: linear-gradient(135deg, #161b22, #0f3460);
    padding: 40px; text-align: center; border-bottom: 2px solid #e94560;
  }
  header h1 { font-size: 28px; color: #fff; margin-bottom: 8px; }
  header p { color: #8b949e; font-size: 14px; }

  .summary {
    display: flex; justify-content: center; gap: 30px; padding: 25px;
    background: #161b22; border-bottom: 1px solid #21262d;
  }
  .stat { text-align: center; }
  .stat .num { font-size: 32px; font-weight: bold; color: #e94560; }
  .stat .label { font-size: 12px; color: #8b949e; text-transform: uppercase; }

  .container { max-width: 1200px; margin: 0 auto; padding: 30px; }

  .project-card {
    background: #161b22; border: 1px solid #21262d; border-radius: 12px;
    margin-bottom: 30px; overflow: hidden;
  }
  .project-header {
    display: flex; justify-content: space-between; align-items: center;
    padding: 20px 25px; border-bottom: 1px solid #21262d;
    background: #1c2333;
  }
  .project-header h2 { font-size: 20px; color: #fff; }
  .project-header .badge {
    background: #e94560; padding: 4px 12px; border-radius: 12px;
    font-size: 12px; font-weight: bold;
  }

  .project-body { display: flex; gap: 0; }
  .project-info { flex: 1; padding: 20px 25px; }
  .project-preview {
    width: 400px; height: 300px; background: #0d1117;
    border-left: 1px solid #21262d; position: relative;
  }
  .project-preview canvas { width: 100%; height: 100%; }

  table { width: 100%; border-collapse: collapse; margin: 10px 0; }
  th { text-align: left; color: #8b949e; font-size: 12px; text-transform: uppercase;
       padding: 6px 0; border-bottom: 1px solid #21262d; }
  td { padding: 5px 0; font-size: 13px; border-bottom: 1px solid #21262d22; }
  td:nth-child(2) { color: #8b949e; font-family: monospace; font-size: 12px; }

  .ref-images { display: flex; gap: 10px; margin-top: 15px; overflow-x: auto; padding-bottom: 10px; }
  .ref-images img {
    height: 100px; border-radius: 6px; border: 1px solid #21262d;
    cursor: pointer; transition: transform 0.2s;
  }
  .ref-images img:hover { transform: scale(1.05); }

  .status-ok { color: #4ecca3; }
  .status-warn { color: #f0a500; }

  .actions { margin-top: 15px; }
  .actions a {
    display: inline-block; padding: 8px 16px; background: #e94560;
    color: #fff; text-decoration: none; border-radius: 6px; font-size: 13px;
    margin-right: 8px;
  }
  .actions a:hover { background: #d63851; }
  .actions a.secondary { background: #21262d; }
  .actions a.secondary:hover { background: #30363d; }

  .notes { margin-top: 15px; padding: 12px; background: #1c2333; border-radius: 8px;
           font-size: 13px; border-left: 3px solid #f0a500; }
  .notes strong { color: #f0a500; }

  footer { text-align: center; padding: 30px; color: #484f58; font-size: 12px; }

  @media (max-width: 800px) {
    .project-body { flex-direction: column; }
    .project-preview { width: 100%; border-left: none; border-top: 1px solid #21262d; }
  }
</style>
</head>
<body>

<header>
  <h1>3D Asset Assembly Report</h1>
  <p>Generated: 2026-02-07 | 7 Projects | Node.js + glTF-Transform</p>
</header>

<div class="summary">
  <div class="stat"><div class="num">7</div><div class="label">Projects</div></div>
  <div class="stat"><div class="num">99</div><div class="label">Total Parts</div></div>
  <div class="stat"><div class="num">57</div><div class="label">GLB Source Files</div></div>
  <div class="stat"><div class="num">13.3</div><div class="label">MB Output</div></div>
</div>

<div class="container" id="projects"></div>

<footer>
  3D Assembly Report | Fine-tune with <a href="viewer.html" style="color:#e94560">Interactive Viewer</a>
</footer>

<script type="importmap">
{
  "imports": {
    "three": "https://cdn.jsdelivr.net/npm/three@0.170.0/build/three.module.js",
    "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.170.0/examples/jsm/"
  }
}
</script>
<script type="module">
import * as THREE from 'three';
import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';

const projects = [
  {
    name: 'Suspension',
    nameKo: '서스펜션 (Coil-Over Shock)',
    file: 'assembled/Suspension_assembled.glb',
    size: '1.6 MB',
    partCount: 5,
    sourceFiles: 5,
    parts: [
      ['Base Mount', 'BASE.glb', 'T:[0, 0, 0]'],
      ['Damper Rod', 'ROD.glb', 'T:[0, 0.028, 0]'],
      ['Coil Spring', 'SPRING.glb', 'T:[0, -0.005, 0]'],
      ['Retainer Ring', 'NIT.glb', 'T:[0, 0.080, 0]'],
      ['Lock Nut', 'NUT.glb', 'T:[0, 0.092, 0]'],
    ],
    images: ['Suspension/서스펜션 조립도.png'],
    notes: 'Rod → Spring → Base 축 정렬. NUT/NIT 상단 잠금 링 배치.'
  },
  {
    name: 'V4_Engine',
    nameKo: 'V4 실린더 엔진',
    file: 'assembled/V4_Engine_assembled.glb',
    size: '3.2 MB',
    partCount: 25,
    sourceFiles: 7,
    parts: [
      ['Crankshaft', 'Crankshaft.glb', 'T:[0, 0, 0]'],
      ['Piston x4', 'Piston.glb', 'X=0.08~0.50, Y=0.22'],
      ['Connecting Rod x4', 'Connecting Rod.glb', 'Y=0.21'],
      ['Rod Cap x4', 'Connecting Rod Cap.glb', 'Y=0.04'],
      ['Piston Ring x4', 'Piston Ring.glb', 'Y=0.29'],
      ['Piston Pin x4', 'Piston Pin.glb', 'Y=0.235, Z=0.04'],
      ['Conrod Bolt x4', 'Conrod Bolt.glb', 'X offset +0.025'],
    ],
    images: ['V4_Engine/V4실린더 엔진 조립도.png'],
    notes: '4개 실린더 등간격 배치 (X: 0.08, 0.22, 0.36, 0.50). 모든 피스톤 TDC(상사점) 위치.'
  },
  {
    name: 'Machine Vice',
    nameKo: '공작 기계 바이스',
    file: 'assembled/Machine Vice_assembled.glb',
    size: '0.3 MB',
    partCount: 12,
    sourceFiles: 10,
    parts: [
      ['Base Plate', 'Part8-grundplatte.glb', 'T:[0, 0, 0]'],
      ['Fixed Jaw', 'Part2 Feste Backe.glb', 'T:[0.11, 0, 0.01]'],
      ['Moving Jaw', 'Part3-lose backe.glb', 'T:[0.055, 0.025, 0.01]'],
      ['Lead Screw', 'Part7-TrapezSpindel.glb', 'T:[0.035, 0.025, 0.12]'],
      ['Jaw Faces x2', 'Part5-Spannbacke.glb', '고정/이동 턱 면'],
      ['Guide Rails x2', 'Part6-fuhrungschiene.glb', '상하 가이드'],
    ],
    images: ['Machine Vice/공작 기계 바이스.jpg', 'Machine Vice/공작 기계 바이스2.png'],
    notes: '기본 판 위에 고정턱 + 이동턱 + 사다리꼴 나사 구성. 가이드 레일 2개 배치.'
  },
  {
    name: 'Robot Arm',
    nameKo: '6축 로봇 암',
    file: 'assembled/Robot Arm_assembled.glb',
    size: '1.8 MB',
    partCount: 8,
    sourceFiles: 8,
    parts: [
      ['Base', 'base.glb', 'T:[0, 0, 0] - 바닥 플랫폼'],
      ['Shoulder', 'Part2.glb', 'T:[0, 0.10, 0.06]'],
      ['Upper Arm', 'Part3.glb', 'T:[0.05, 0.28, 0.12] R:50°'],
      ['Forearm', 'Part4.glb', 'T:[-0.12, 0.42, 0.18] R:-20°'],
      ['Wrist', 'Part5.glb', 'T:[-0.18, 0.50, 0.28]'],
      ['Wrist Joint', 'Part6.glb', 'T:[-0.20, 0.52, 0.22]'],
      ['End Effector', 'Part7.glb', 'T:[-0.23, 0.54, 0.20]'],
      ['Gripper', 'Part8.glb', 'T:[-0.25, 0.55, 0.18]'],
    ],
    images: ['Robot Arm/로보팔 조립도.png'],
    notes: '관절 로봇 - 어깨부터 그리퍼까지 8개 링크. 조립도 포즈에 맞춰 회전값 적용.'
  },
  {
    name: 'Robot Gripper',
    nameKo: '기어 구동 로봇 집게',
    file: 'assembled/Robot Gripper_assembled.glb',
    size: '1.4 MB',
    partCount: 12,
    sourceFiles: 8,
    parts: [
      ['Base Plate', 'Base Plate.glb', '기본 몸체'],
      ['Mount Bracket', 'Base Mounting bracket.glb', '후면 마운트'],
      ['Drive Gear', 'Base Gear.glb', '구동 기어'],
      ['Gear Links x2', 'Gear link 1/2.glb', '기어 링키지'],
      ['Grippers x2', 'Gripper.glb', '좌/우 핑거 (180° 미러)'],
      ['Links x2', 'Link.glb', '연결 링크'],
      ['Pins x3', 'Pin.glb', '피벗 핀'],
    ],
    images: ['Robot Gripper/로봇집게 조립도.png', 'Robot Gripper/로봇집게 조립도2.png', 'Robot Gripper/로봇집게 조립도3.png'],
    notes: 'Gripper R은 Y축 180° 회전으로 미러 배치. 기어 메커니즘 중심 조립.'
  },
  {
    name: 'Leaf Spring',
    nameKo: '판 스프링 (리프 스프링)',
    file: 'assembled/Leaf Spring_assembled.glb',
    size: '1.1 MB',
    partCount: 9,
    sourceFiles: 9,
    parts: [
      ['Leaf Stack', 'Leaf-Layer.glb', '메인 판 스프링 적층'],
      ['Center Clamp', 'Clamp-Center.glb', '중앙 U볼트 클램프'],
      ['Primary Clamp', 'Clamp-Primary.glb', 'Z=+0.18 위치'],
      ['Secondary Clamp', 'Clamp-Secondary.glb', 'Z=-0.18 위치'],
      ['Support', 'Support.glb', '지지 브래킷'],
      ['Chassis Mounts x2', 'Support-Chassis*.glb', '차대 마운트 양쪽'],
      ['Rubber Bushings x2', 'Support-Rubber*.glb', '고무 부싱 양쪽'],
    ],
    images: ['Leaf Spring/판스프링 조립도.png', 'Leaf Spring/판스프링 조립도2.png'],
    notes: '스프링 축(Z축) 기준으로 클램프와 마운트 배치. 클램프 X 오프셋 0.08로 중심 정렬.'
  },
  {
    name: 'Drone',
    nameKo: '쿼드콥터 드론',
    file: 'assembled/Drone_assembled.glb',
    size: '3.9 MB',
    partCount: 28,
    sourceFiles: 10,
    parts: [
      ['Frame (L+R)', 'Main frame*.glb', '좌/우 프레임 미러'],
      ['Motor Pod x4', 'Arm gear.glb', '4개 모터 하우징'],
      ['Propeller x4', 'Impellar Blade.glb', '4개 프로펠러'],
      ['Gearing x4', 'Gearing.glb', '모터 샤프트'],
      ['Disc x4', 'Beater disc.glb', '모터 디스크'],
      ['Leg x4', 'Leg.glb', '랜딩 기어'],
      ['Camera', 'xyz.glb', '하부 카메라/짐벌'],
      ['Caps + Screws', 'Nut/Screw.glb', '고정 부품'],
    ],
    images: ['Drone/조립도1.png', 'Drone/조립도6.png'],
    notes: '프레임 2개(좌/우 미러)가 본체, 4개 모터 포드가 팔 끝에 배치. 카메라는 본체 하부.'
  }
];

// Render project cards
const container = document.getElementById('projects');
projects.forEach((proj, idx) => {
  const card = document.createElement('div');
  card.className = 'project-card';
  card.innerHTML = `
    <div class="project-header">
      <h2>${idx+1}. ${proj.nameKo}</h2>
      <span class="badge">${proj.partCount} parts | ${proj.size}</span>
    </div>
    <div class="project-body">
      <div class="project-info">
        <table>
          <tr><th>Part</th><th>Transform</th></tr>
          ${proj.parts.map(p => `<tr><td>${p[0]}</td><td>${p[2]}</td></tr>`).join('')}
        </table>
        <div class="notes"><strong>Notes:</strong> ${proj.notes}</div>
        <div class="ref-images">
          ${proj.images.map(img => `<img src="${encodeURI(img)}" alt="ref">`).join('')}
        </div>
        <div class="actions">
          <a href="viewer.html" target="_blank">Open in Viewer</a>
          <a href="${proj.file}" download class="secondary">Download GLB</a>
        </div>
      </div>
      <div class="project-preview" id="preview-${idx}"></div>
    </div>
  `;
  container.appendChild(card);

  // Setup 3D preview
  setTimeout(() => setup3D(idx, proj.file), idx * 200);
});

function setup3D(idx, glbFile) {
  const el = document.getElementById(`preview-${idx}`);
  if (!el) return;

  const scene = new THREE.Scene();
  scene.background = new THREE.Color(0x0d1117);

  const camera = new THREE.PerspectiveCamera(45, el.clientWidth / el.clientHeight, 0.001, 100);
  const renderer = new THREE.WebGLRenderer({ antialias: true });
  renderer.setSize(el.clientWidth, el.clientHeight);
  renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
  renderer.toneMapping = THREE.ACESFilmicToneMapping;
  renderer.toneMappingExposure = 1.2;
  el.appendChild(renderer.domElement);

  const controls = new OrbitControls(camera, renderer.domElement);
  controls.enableDamping = true;
  controls.autoRotate = true;
  controls.autoRotateSpeed = 1.5;

  scene.add(new THREE.AmbientLight(0xffffff, 0.5));
  const dl = new THREE.DirectionalLight(0xffffff, 1.5);
  dl.position.set(3, 5, 4);
  scene.add(dl);
  scene.add(new THREE.DirectionalLight(0x8888ff, 0.4).position.set(-3, 3, -3));

  const loader = new GLTFLoader();
  loader.load(glbFile, (gltf) => {
    scene.add(gltf.scene);
    const box = new THREE.Box3().setFromObject(gltf.scene);
    const center = box.getCenter(new THREE.Vector3());
    const size = box.getSize(new THREE.Vector3());
    const maxDim = Math.max(size.x, size.y, size.z);
    camera.position.set(center.x + maxDim, center.y + maxDim * 0.6, center.z + maxDim);
    controls.target.copy(center);
    controls.update();
  });

  function animate() {
    requestAnimationFrame(animate);
    controls.update();
    renderer.render(scene, camera);
  }
  animate();
}
</script>
</body>
</html>
